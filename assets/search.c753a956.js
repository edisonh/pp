import{d as ne,r as p,m as le,l as ie,p as oe,ab as ue,n as ce,o as re,b as C,s as D,E as g,e as n,f as a,as as de,w as l,ad as fe,M as he,F as b,D as B,R as _e,aA as pe,Q as y,c as ge,y as h,A as ve,a9 as ye,ag as Fe,a7 as ke,I as N,ah as me,ak as we,P as Ce,U as c,a8 as O,at as Ee}from"./vendor.b04d76c4.js";import{i as r,b as De}from"./index.5c76143d.js";const be={class:"list-page list-page-files"},Be={class:"header"},Ne={class:"search"},Se=h(" \u641C\u7D22 "),xe={class:"action"},Ae=h(" \u68C0\u67E5\u672A\u4E0B\u8F7D\u6587\u4EF6 "),$e=h(" \u68C0\u67E5\u91CD\u590D\u6587\u4EF6 "),Re=h(" \u68C0\u67E5\u5DF2\u5220\u9664\u6587\u4EF6 "),Ie=h("\u91CD\u65B0\u626B\u63CF"),ze={key:0,class:"loading"},Me=h("\u52A0\u8F7D\u4E2D "),Le={key:0,class:"outer-wrapper static show"},Oe={class:"toolbar-wrapper"},Pe=h(" \u526A\u5207\u6240\u9009 "),Te=h(" \u6279\u91CF\u4E0B\u8F7D "),Ue=h(" \u5220\u9664\u6240\u9009 "),Je=ne({setup(He){const d=p(),P=le();ie();const u=p([]);oe();const T=p(!1),m=p(),S=ue(),F=p(),E=p("");let v=null;const U=p([{type:"selection"},{title:"\u540D\u79F0",key:"name",sorter:"default",render:e=>c("div",{class:"file-info"},[c("img",{src:e.thumbnail_link||e.icon_link}),c(O,{class:"title"},[c("span",{},String(e.name)),e.exist?c("a",{style:"color: #306eff; text-decoration: underline; float: right;",target:"_blank",href:e.exist.url,onClick:Ee(()=>{},["stop"])},[e.exist.filename,c("span",{style:"color:red"},e.exist.size)]):c("span")]),c("span",{class:"action"},"1")])},{title:"\u5927\u5C0F",key:"size",sorter:(e,s)=>e.size-s.size,align:"right",render:e=>Number(e.size)>0?De(Number(e.size)):"",className:"size",width:100},{title:"\u8DEF\u5F84",key:"path",sorter:"default",render:e=>c("div",{class:"file-info"},[c("img",{src:e.icon_link}),c(O,{class:"title"},{default:()=>String(e.path)})])}]),x=()=>{m.value=JSON.parse(window.localStorage.getItem("pikpakMoveFiles")||"[]"),d.value=[],u.value=[]};ce(P,()=>{x()}),re(()=>{x()});const H=e=>{e.target.offsetHeight+e.target.scrollTop>=e.target.scrollHeight-30},V=e=>{let s=[];d.value.forEach(t=>{if(u.value.indexOf(t.id)!==-1)s.push(t.id);else if(t.children)for(let i in t.children)u.value.indexOf(t.children[i].id)!==-1&&s.push(t.children[i].id)}),q(s),u.value=[]},q=e=>{m.value=e,window.localStorage.setItem("pikpakMoveFiles",JSON.stringify(e)),window.$message.success("\u526A\u5207\u6210\u529F\uFF0C\u8BF7\u70B9\u51FB\u9875\u9762\u53F3\u4E0A\u65B9\u7C98\u8D34\u6309\u94AE")},J=e=>{r.post("https://api-drive.mypikpak.com/drive/v1/files:batchTrash",{ids:typeof e=="string"?[e]:e}).then(()=>{X(typeof e=="string"?[e]:e),window.$message.success("\u5220\u9664\u6210\u529F"),u.value=[],v&&v()})},j=async()=>{const e=async o=>await r.get("https://api-drive.mypikpak.com/drive/v1/files/"+o,{params:{_magic:"2021",thumbnail_size:"SIZE_LARGE"}}),s=async()=>{const o=JSON.parse(JSON.stringify(u.value)),f=new Set;for(let k in d.value)d.value[k].kind==="drive#folder"&&f.add(d.value[k].id);const M=[];for(let k in o){if(f.has(o[k]))continue;const L=await e(o[k]);M.push({url:L.data.web_content_link,filename:L.data.name})}return M},t=o=>{const f="chrome_extension_id";chrome.runtime.sendMessage(f,{msg:"pikpak_batch_download",items:o})};F.value=S.create({title:"\u6279\u91CF\u4E0B\u8F7D\u6587\u4EF6",closable:!0,content:"\u6B63\u5728\u83B7\u53D6\u6587\u4EF6\u5217\u8868..."});const i=await s();u.value=[],F.value.content="\u5171\u83B7\u53D6\u5230"+i.length+"\u4E2A\u6587\u4EF6",t(i)},A=async()=>{d.value=await Y("name",E.value),v=A},$=async()=>{d.value=await Q(),v=$},G=async(e,s,t)=>{const i={phase:{eq:"PHASE_TYPE_COMPLETE"},trashed:{eq:!1}};return(await r.get("https://api-drive.mypikpak.com/drive/v1/files",{params:{parent_id:e,limit:s,filters:i,thumbnail_size:"SIZE_LARGE",with_audit:!0,page_token:t||void 0}})).data},Z=async e=>{const s=100;let t="",i=[];for(let o=0;o<10;o++){const f=await G(e,s,t);if(i=i.concat(f.files),f.files.length<s||!f.next_page_token)break;t=f.next_page_token}return i},_="http://localhost:3000/pikpak",K=async(e,s)=>{await r.post(`${_}/files`,{parentIds:e,files:s})},Q=async()=>(await r.get(`${_}/files/redundancy`)).data,R=async()=>(await r.get(`${_}/files/undownloaded`)).data,I=async()=>(await r.get(`${_}/files/deleted`)).data,X=async e=>{await r.get(`${_}/delete/files/${e.join(",")}`)},Y=async(e,s)=>(await r.get(`${_}/files/${e}/${encodeURIComponent(s)}`)).data,W=async e=>(await r.get(`${_}/file/${e}`)).data,ee=async e=>{await r.get(`${_}/file/scanned/${e}`)},z=async e=>{const s=e[e.length-1],t=await Z(s);await K(e,t);for(let i=0;i<t.length;i++)t[i].kind=="drive#folder"&&((await W(t[i].id)).scanned||await z(e.concat([t[i].id]))),e.length==1&&w(`\u5DF2\u626B\u63CF${Math.floor((i+1)/t.length*100)}%(${i+1}/${t.length})...`);s!=""&&await ee(s)},w=async e=>{if(F.value)try{F.value.destroy()}catch{}F.value=S.info({title:e})},te=async()=>{w("\u5F00\u59CB\u626B\u63CF\u5168\u76D8...");try{await z([""]),w("\u626B\u63CF\u5B8C\u6210")}catch(e){w("\u626B\u63CF\u51FA\u9519: "+e)}},se=async()=>{d.value=await R(),v=R},ae=async()=>{d.value=await I(),v=I};return(e,s)=>(C(),D("div",be,[g("div",Be,[g("div",Ne,[n(a(de),null,{default:l(()=>[n(a(_e),{placeholder:"\u6587\u4EF6\u540D\u3001hash",value:E.value,"onUpdate:value":s[0]||(s[0]=t=>E.value=t)},{prefix:l(()=>[n(a(pe))]),_:1},8,["value"]),n(a(y),{type:"primary",ghost:"",onClick:A},{default:l(()=>[Se]),_:1})]),_:1})]),g("div",xe,[n(a(fe),null,{default:l(()=>{var t;return[((t=m.value)==null?void 0:t.length)?(C(),ge(a(y),{key:0,type:"default"},{default:l(()=>[h(" \u7C98\u8D34\u5DF2\u526A\u5207"+ve(m.value.length)+"\u9879\u8D44\u6E90 ",1)]),_:1})):B("",!0),n(a(y),{onClick:se},{default:l(()=>[Ae]),_:1}),n(a(y),{onClick:$},{default:l(()=>[$e]),_:1}),n(a(y),{onClick:ae},{default:l(()=>[Re]),_:1}),n(a(ye),{onPositiveClick:te},{trigger:l(()=>[n(a(y),null,{default:l(()=>[Ie]),_:1})]),_:1})]}),_:1})])]),n(a(he),{style:{"max-height":"calc(100vh - 190px)"},onScroll:H},{default:l(()=>[n(a(Fe),{"checked-row-keys":u.value,"onUpdate:checked-row-keys":s[1]||(s[1]=t=>u.value=t),"row-key":t=>t.id,data:d.value,size:"small",columns:U.value,bordered:!1},null,8,["checked-row-keys","row-key","data","columns"]),T.value?(C(),D("div",ze,[n(a(ke),{size:"small"}),Me])):B("",!0)]),_:1}),u.value.length?(C(),D("div",Le,[g("div",Oe,[g("div",{class:"toolbar-item",onClick:V},[n(a(b),null,{trigger:l(()=>[n(a(N),null,{default:l(()=>[n(a(me))]),_:1})]),default:l(()=>[Pe]),_:1})]),g("div",{class:"toolbar-item",onClick:j},[n(a(b),null,{trigger:l(()=>[n(a(N),null,{default:l(()=>[n(a(we))]),_:1})]),default:l(()=>[Te]),_:1})]),g("div",{class:"toolbar-item",onClick:s[2]||(s[2]=t=>J(u.value))},[n(a(b),null,{trigger:l(()=>[n(a(N),null,{default:l(()=>[n(a(Ce))]),_:1})]),default:l(()=>[Ue]),_:1})])])])):B("",!0)]))}});export{Je as default};
