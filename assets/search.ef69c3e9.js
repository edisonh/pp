var he=Object.defineProperty,ge=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var H=(h,s,u)=>s in h?he(h,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):h[s]=u,D=(h,s)=>{for(var u in s||(s={}))_e.call(s,u)&&H(h,u,s[u]);if(q)for(var u of q(s))ve.call(s,u)&&H(h,u,s[u]);return h},B=(h,s)=>ge(h,pe(s));import{d as ye,r as y,n as me,l as ke,q as Fe,ac as we,p as Ce,o as Ee,b as S,t as N,F as m,e as l,f as n,at as De,w as i,ae as Be,O as Se,G as $,E as A,S as be,aB as xe,R as k,c as Ne,A as f,B as $e,aa as Ae,ah as Re,a8 as Ie,J as R,ai as ze,al as Le,Q as Me,V as p,a9 as G,au as Oe}from"./vendor.3aa20550.js";import{i as r,b as Pe}from"./index.08bda1f4.js";const Te={class:"list-page list-page-files"},Ue={class:"header"},Je={class:"search"},Ve=f(" \u641C\u7D22 "),qe={class:"action"},He=f(" \u68C0\u67E5\u672A\u4E0B\u8F7D\u6587\u4EF6 "),Ge=f(" \u68C0\u67E5\u91CD\u590D\u6587\u4EF6 "),je=f(" \u68C0\u67E5\u5DF2\u5220\u9664\u6587\u4EF6 "),Ze=f(" \u68C0\u67E5\u5927\u6587\u4EF6 "),Ke=f("\u91CD\u65B0\u626B\u63CF"),Qe={key:0,class:"loading"},Xe=f("\u52A0\u8F7D\u4E2D "),Ye={key:0,class:"outer-wrapper static show"},We={class:"toolbar-wrapper"},et=f(" \u526A\u5207\u6240\u9009 "),tt=f(" \u6279\u91CF\u4E0B\u8F7D "),at=f(" \u5220\u9664\u6240\u9009 "),it=ye({setup(h){const s=y(),u=me();ke();const d=y([]);Fe();const j=y(!1),C=y(),I=we(),F=y(),b=y("");let v=null;const Z=y([{type:"selection"},{title:"\u540D\u79F0",key:"name",sorter:"default",render:e=>p("div",{class:"file-info"},[p("img",{src:e.thumbnail_link||e.icon_link}),p(G,{class:"title"},[p("span",{},String(e.name)),e.exist?p("a",{style:"color: #306eff; text-decoration: underline; float: right;",target:"_blank",href:e.exist.url,onClick:Oe(()=>{},["stop"])},[e.exist.filename]):p("span")]),p("span",{class:"action"},"1")])},{title:"\u5927\u5C0F",key:"size",sorter:(e,t)=>e.size-t.size,align:"right",render:e=>Number(e.size)>0?Pe(Number(e.size)):"",className:"size",width:100},{title:"\u8DEF\u5F84",key:"path",sorter:"default",render:e=>p("div",{class:"file-info"},[p("img",{src:e.icon_link}),p(G,{class:"title"},{default:()=>String(e.path)})])}]),z=()=>{C.value=JSON.parse(window.localStorage.getItem("pikpakMoveFiles")||"[]"),s.value=[],d.value=[]};Ce(u,()=>{z()}),Ee(()=>{z()});const K=e=>{e.target.offsetHeight+e.target.scrollTop>=e.target.scrollHeight-30},Q=e=>{let t=[];s.value.forEach(a=>{if(d.value.indexOf(a.id)!==-1)t.push(a.id);else if(a.children)for(let o in a.children)d.value.indexOf(a.children[o].id)!==-1&&t.push(a.children[o].id)}),X(t),d.value=[]},X=e=>{C.value=e,window.localStorage.setItem("pikpakMoveFiles",JSON.stringify(e)),window.$message.success("\u526A\u5207\u6210\u529F\uFF0C\u8BF7\u70B9\u51FB\u9875\u9762\u53F3\u4E0A\u65B9\u7C98\u8D34\u6309\u94AE")},Y=e=>{r.post("https://api-drive.mypikpak.com/drive/v1/files:batchTrash",{ids:typeof e=="string"?[e]:e}).then(()=>{ne(typeof e=="string"?[e]:e),le(typeof e=="string"?[e]:e),window.$message.success("\u5220\u9664\u6210\u529F"),d.value=[],v&&v()})},W=async()=>{const e=async c=>await r.get("https://api-drive.mypikpak.com/drive/v1/files/"+c,{params:{_magic:"2021",thumbnail_size:"SIZE_LARGE"}}),t=async()=>{const c=JSON.parse(JSON.stringify(d.value)),g=new Set;for(let w in s.value)s.value[w].kind==="drive#folder"&&g.add(s.value[w].id);const J=[];for(let w in c){if(g.has(c[w]))continue;const V=await e(c[w]);J.push({url:V.data.web_content_link,filename:V.data.name})}return J},a=c=>{const g="chrome_extension_id";chrome.runtime.sendMessage(g,{msg:"pikpak_batch_download",items:c})};F.value=I.create({title:"\u6279\u91CF\u4E0B\u8F7D\u6587\u4EF6",closable:!0,content:"\u6B63\u5728\u83B7\u53D6\u6587\u4EF6\u5217\u8868..."});const o=await t();d.value=[],F.value.content="\u5171\u83B7\u53D6\u5230"+o.length+"\u4E2A\u6587\u4EF6",a(o)},L=async()=>{s.value=await ie("name",b.value),v=L},M=async()=>{s.value=await se(),v=M},ee=async(e,t,a)=>{const o={phase:{eq:"PHASE_TYPE_COMPLETE"},trashed:{eq:!1}};return(await r.get("https://api-drive.mypikpak.com/drive/v1/files",{params:{parent_id:e,limit:t,filters:o,thumbnail_size:"SIZE_LARGE",with_audit:!0,page_token:a||void 0}})).data},te=async e=>{const t=100;let a="",o=[];for(let c=0;c<10;c++){const g=await ee(e,t,a);if(o=o.concat(g.files),g.files.length<t||!g.next_page_token)break;a=g.next_page_token}return o},_="http://localhost:3000/pikpak",ae=async(e,t)=>{await r.post(`${_}/files`,{parentIds:e,files:t})},se=async()=>(await r.get(`${_}/files/redundancy`)).data,O=async()=>(await r.get(`${_}/files/undownloaded`)).data,P=async()=>(await r.get(`${_}/files/deleted`)).data,T=async()=>(await r.get(`${_}/files/large`)).data,ne=async e=>{try{await r.get(`${_}/delete/files/${e.join(",")}`)}catch(t){console.error("Error deleting file records:",t)}},le=async e=>{try{const t=window.location.origin.replace(/:\/\/.*?\./,"://myyun."),a=window.localStorage.getItem("myyun_token");if(!a)throw new Error("Myyun token not found");await fetch(`${t}/xvideo/api/pik/files/delete`,{method:"POST",body:JSON.stringify(e),headers:{Authorization:`Bearer ${a}`}})}catch(t){console.error("Error adding PikPak file to Myyun:",t)}},ie=async(e,t)=>(await r.get(`${_}/files/${e}/${encodeURIComponent(t)}`)).data,oe=async e=>(await r.get(`${_}/file/${e}`)).data,ue=async e=>{await r.get(`${_}/file/scanned/${e}`)},U=async e=>{const t=e[e.length-1],a=await te(t);await ae(e,a);for(let o=0;o<a.length;o++)a[o].kind=="drive#folder"&&((await oe(a[o].id)).scanned||await U(e.concat([a[o].id]))),e.length==1&&E(`\u5DF2\u626B\u63CF${Math.floor((o+1)/a.length*100)}%(${o+1}/${a.length})...`);t!=""&&await ue(t)},E=async e=>{if(F.value)try{F.value.destroy()}catch{}F.value=I.info({title:e})},ce=async()=>{E("\u5F00\u59CB\u626B\u63CF\u5168\u76D8...");try{await U([""]),E("\u626B\u63CF\u5B8C\u6210")}catch(e){E("\u626B\u63CF\u51FA\u9519: "+e)}},re=async()=>{let e=await O();e=e.map(t=>B(D({},t),{exist:{filename:t.name,url:x(t.name)}})),s.value=e,v=O},x=e=>`http://localhost:3000/xvideo/search/vid/${encodeURIComponent(e)}`,de=async()=>{let e=await P();e=e.map(t=>B(D({},t),{exist:{filename:t.name,url:x(t.name)}})),s.value=e,v=P},fe=async()=>{let e=await T();e=e.map(t=>B(D({},t),{exist:{filename:t.name,url:x(t.name)}})),s.value=e,v=T};return(e,t)=>(S(),N("div",Te,[m("div",Ue,[m("div",Je,[l(n(De),null,{default:i(()=>[l(n(be),{placeholder:"\u6587\u4EF6\u540D\u3001hash",value:b.value,"onUpdate:value":t[0]||(t[0]=a=>b.value=a)},{prefix:i(()=>[l(n(xe))]),_:1},8,["value"]),l(n(k),{type:"primary",ghost:"",onClick:L},{default:i(()=>[Ve]),_:1})]),_:1})]),m("div",qe,[l(n(Be),null,{default:i(()=>{var a;return[((a=C.value)==null?void 0:a.length)?(S(),Ne(n(k),{key:0,type:"default"},{default:i(()=>[f(" \u7C98\u8D34\u5DF2\u526A\u5207"+$e(C.value.length)+"\u9879\u8D44\u6E90 ",1)]),_:1})):A("",!0),l(n(k),{onClick:re},{default:i(()=>[He]),_:1}),l(n(k),{onClick:M},{default:i(()=>[Ge]),_:1}),l(n(k),{onClick:de},{default:i(()=>[je]),_:1}),l(n(k),{onClick:fe},{default:i(()=>[Ze]),_:1}),l(n(Ae),{onPositiveClick:ce},{trigger:i(()=>[l(n(k),null,{default:i(()=>[Ke]),_:1})]),_:1})]}),_:1})])]),l(n(Se),{style:{"max-height":"calc(100vh - 190px)"},onScroll:K},{default:i(()=>[l(n(Re),{"checked-row-keys":d.value,"onUpdate:checked-row-keys":t[1]||(t[1]=a=>d.value=a),"row-key":a=>a.id,data:s.value,size:"small",columns:Z.value,bordered:!1},null,8,["checked-row-keys","row-key","data","columns"]),j.value?(S(),N("div",Qe,[l(n(Ie),{size:"small"}),Xe])):A("",!0)]),_:1}),d.value.length?(S(),N("div",Ye,[m("div",We,[m("div",{class:"toolbar-item",onClick:Q},[l(n($),null,{trigger:i(()=>[l(n(R),null,{default:i(()=>[l(n(ze))]),_:1})]),default:i(()=>[et]),_:1})]),m("div",{class:"toolbar-item",onClick:W},[l(n($),null,{trigger:i(()=>[l(n(R),null,{default:i(()=>[l(n(Le))]),_:1})]),default:i(()=>[tt]),_:1})]),m("div",{class:"toolbar-item",onClick:t[2]||(t[2]=a=>Y(d.value))},[l(n($),null,{trigger:i(()=>[l(n(R),null,{default:i(()=>[l(n(Me))]),_:1})]),default:i(()=>[at]),_:1})])])])):A("",!0)]))}});export{it as default};
