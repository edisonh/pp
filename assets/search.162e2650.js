import{d as Z,r as d,m as K,l as Q,p as X,ab as Y,n as W,o as ee,b as m,s as w,E as f,e as l,f as a,aq as te,w as n,ad as se,M as ae,F as C,D as E,R as le,ay as ie,Q as y,c as ne,y as r,A as oe,ag as ue,a7 as ce,I as D,ah as re,aj as de,P as fe,U as u,a8 as z,ar as he}from"./vendor.54f6d311.js";import{i as F,b as pe}from"./index.09e20907.js";const _e={class:"list-page list-page-files"},ve={class:"header"},ge={class:"search"},ke=r(" \u641C\u7D22 "),me={class:"action"},ye=r(" \u68C0\u67E5\u91CD\u590D\u6587\u4EF6 "),Fe=r(" \u91CD\u65B0\u626B\u63CF "),we={key:0,class:"loading"},Ce=r("\u52A0\u8F7D\u4E2D "),Ee={key:0,class:"outer-wrapper static show"},De={class:"toolbar-wrapper"},be=r(" \u526A\u5207\u6240\u9009 "),Be=r(" \u6279\u91CF\u4E0B\u8F7D "),Ne=r(" \u5220\u9664\u6240\u9009 "),ze=Z({setup(Se){const h=d(),I=K();Q();const c=d([]);X();const M=d(!1),g=d(),b=Y(),p=d(),B=d(""),R=d([{type:"selection"},{title:"\u540D\u79F0",key:"name",sorter:"default",render:e=>u("div",{class:"file-info"},[u("img",{src:e.thumbnail_link||e.icon_link}),u(z,{class:"title"},[u("span",{},String(e.name)),e.exist?u("a",{style:"color: #306eff; text-decoration: underline; float: right;",target:"_blank",href:e.exist.url,onClick:he(()=>{},["stop"])},[e.exist.filename,u("span",{style:"color:red"},e.exist.size)]):u("span")]),u("span",{class:"action"},"1")])},{title:"\u5927\u5C0F",key:"size",sorter:(e,s)=>e.size-s.size,align:"right",render:e=>Number(e.size)>0?pe(Number(e.size)):"",className:"size",width:100},{title:"\u8DEF\u5F84",key:"path",sorter:"default",render:e=>u("div",{class:"file-info"},[u("img",{src:e.icon_link}),u(z,{class:"title"},{default:()=>String(e.name)}),u("span",{class:"action"},"1")])}]),N=()=>{g.value=JSON.parse(window.localStorage.getItem("pikpakMoveFiles")||"[]"),h.value=[],c.value=[]};W(I,()=>{N()}),ee(()=>{N()});const L=e=>{e.target.offsetHeight+e.target.scrollTop>=e.target.scrollHeight-30},O=e=>{let s=[];h.value.forEach(t=>{if(c.value.indexOf(t.id)!==-1)s.push(t.id);else if(t.children)for(let i in t.children)c.value.indexOf(t.children[i].id)!==-1&&s.push(t.children[i].id)}),T(s),c.value=[]},T=e=>{g.value=e,window.localStorage.setItem("pikpakMoveFiles",JSON.stringify(e)),window.$message.success("\u526A\u5207\u6210\u529F\uFF0C\u8BF7\u70B9\u51FB\u9875\u9762\u53F3\u4E0A\u65B9\u7C98\u8D34\u6309\u94AE")},$=e=>{F.post("https://api-drive.mypikpak.com/drive/v1/files:batchTrash",{ids:typeof e=="string"?[e]:e}).then(()=>{window.$message.success("\u5220\u9664\u6210\u529F"),c.value=[]})},P=async()=>{const e=async o=>await F.get("https://api-drive.mypikpak.com/drive/v1/files/"+o,{params:{_magic:"2021",thumbnail_size:"SIZE_LARGE"}}),s=async()=>{const o=JSON.parse(JSON.stringify(c.value)),_=new Set;for(let v in h.value)h.value[v].kind==="drive#folder"&&_.add(h.value[v].id);const x=[];for(let v in o){if(_.has(o[v]))continue;const A=await e(o[v]);x.push({url:A.data.web_content_link,filename:A.data.name})}return x},t=o=>{const _="chrome_extension_id";chrome.runtime.sendMessage(_,{msg:"pikpak_batch_download",items:o})};p.value=b.create({title:"\u6279\u91CF\u4E0B\u8F7D\u6587\u4EF6",closable:!0,content:"\u6B63\u5728\u83B7\u53D6\u6587\u4EF6\u5217\u8868..."});const i=await s();c.value=[],p.value.content="\u5171\u83B7\u53D6\u5230"+i.length+"\u4E2A\u6587\u4EF6",t(i)},H=async()=>{},V=async()=>{},q=async(e,s,t)=>{const i={phase:{eq:"PHASE_TYPE_COMPLETE"},trashed:{eq:!1}};return(await F.get("https://api-drive.mypikpak.com/drive/v1/files",{params:{parent_id:e,limit:s,filters:i,thumbnail_size:"SIZE_LARGE",with_audit:!0,page_token:t||void 0}})).data},J=async e=>{const s=100;let t="",i=[];for(;;){const o=await q(e,s,t);if(i=i.concat(o.files),o.files.length<s||!o.next_page_token)break}return i},U="http://localhost:3000/pikpak",j=async(e,s)=>{await F.post(`${U}/files`,{parentIds:e,files:s})},S=async e=>{const s=e[e.length-1],t=await J(s);await j(e,t);for(let i=0;i<t.length;i++)t[i].kind=="drive#folder"&&await S(e.concat([t[i].id])),e.length==1&&k(`\u5DF2\u626B\u63CF${Math.floor((i+1)/t.length*100)}%(${i+1}/${t.length})...`)},k=async e=>{p.value&&p.value.destroy(),p.value=b.info({title:e})},G=async()=>{k("\u5F00\u59CB\u626B\u63CF\u5168\u76D8...");try{await S([""]),k("\u626B\u63CF\u5B8C\u6210")}catch(e){k("\u626B\u63CF\u51FA\u9519: "+e)}};return(e,s)=>(m(),w("div",_e,[f("div",ve,[f("div",ge,[l(a(te),null,{default:n(()=>[l(a(le),{placeholder:"\u6587\u4EF6\u540D\u3001hash",value:B.value,"onUpdate:value":s[0]||(s[0]=t=>B.value=t)},{prefix:n(()=>[l(a(ie))]),_:1},8,["value"]),l(a(y),{type:"primary",ghost:"",onClick:H},{default:n(()=>[ke]),_:1})]),_:1})]),f("div",me,[l(a(se),null,{default:n(()=>{var t;return[((t=g.value)==null?void 0:t.length)?(m(),ne(a(y),{key:0,type:"default"},{default:n(()=>[r(" \u7C98\u8D34\u5DF2\u526A\u5207"+oe(g.value.length)+"\u9879\u8D44\u6E90 ",1)]),_:1})):E("",!0),l(a(y),{onClick:V},{default:n(()=>[ye]),_:1}),l(a(y),{onClick:G},{default:n(()=>[Fe]),_:1})]}),_:1})])]),l(a(ae),{style:{"max-height":"calc(100vh - 190px)"},onScroll:L},{default:n(()=>[l(a(ue),{"checked-row-keys":c.value,"onUpdate:checked-row-keys":s[1]||(s[1]=t=>c.value=t),"row-key":t=>t.id,data:h.value,size:"small",columns:R.value,bordered:!1},null,8,["checked-row-keys","row-key","data","columns"]),M.value?(m(),w("div",we,[l(a(ce),{size:"small"}),Ce])):E("",!0)]),_:1}),c.value.length?(m(),w("div",Ee,[f("div",De,[f("div",{class:"toolbar-item",onClick:O},[l(a(C),null,{trigger:n(()=>[l(a(D),null,{default:n(()=>[l(a(re))]),_:1})]),default:n(()=>[be]),_:1})]),f("div",{class:"toolbar-item",onClick:P},[l(a(C),null,{trigger:n(()=>[l(a(D),null,{default:n(()=>[l(a(de))]),_:1})]),default:n(()=>[Be]),_:1})]),f("div",{class:"toolbar-item",onClick:s[2]||(s[2]=t=>$(c.value))},[l(a(C),null,{trigger:n(()=>[l(a(D),null,{default:n(()=>[l(a(fe))]),_:1})]),default:n(()=>[Ne]),_:1})])])])):E("",!0)]))}});export{ze as default};
