import{d as te,r as p,n as se,l as ae,q as le,ac as ne,p as ie,o as oe,b as w,t as B,F as _,e as l,f as a,as as ue,w as i,ae as ce,O as re,G as D,E as S,S as de,aA as fe,R as C,c as he,A as h,B as pe,aa as _e,ah as ve,a8 as ge,J as b,ai as ye,ak as ke,Q as me,V as c,a9 as M,at as Fe}from"./vendor.8c394501.js";import{i as d,b as we}from"./index.09241481.js";const Ce={class:"list-page list-page-files"},Ee={class:"header"},Be={class:"search"},De=h(" \u641C\u7D22 "),Se={class:"action"},be=h(" \u68C0\u67E5\u91CD\u590D\u6587\u4EF6 "),Ne=h("\u91CD\u65B0\u626B\u63CF"),xe={key:0,class:"loading"},Ae=h("\u52A0\u8F7D\u4E2D "),$e={key:0,class:"outer-wrapper static show"},Re={class:"toolbar-wrapper"},ze=h(" \u526A\u5207\u6240\u9009 "),Ie=h(" \u6279\u91CF\u4E0B\u8F7D "),Me=h(" \u5220\u9664\u6240\u9009 "),Pe=te({setup(Le){const f=p(),L=se();ae();const u=p([]);le();const O=p(!1),k=p(),N=ne(),v=p(),E=p("");let m=null;const T=p([{type:"selection"},{title:"\u540D\u79F0",key:"name",sorter:"default",render:e=>c("div",{class:"file-info"},[c("img",{src:e.thumbnail_link||e.icon_link}),c(M,{class:"title"},[c("span",{},String(e.name)),e.exist?c("a",{style:"color: #306eff; text-decoration: underline; float: right;",target:"_blank",href:e.exist.url,onClick:Fe(()=>{},["stop"])},[e.exist.filename,c("span",{style:"color:red"},e.exist.size)]):c("span")]),c("span",{class:"action"},"1")])},{title:"\u5927\u5C0F",key:"size",sorter:(e,t)=>e.size-t.size,align:"right",render:e=>Number(e.size)>0?we(Number(e.size)):"",className:"size",width:100},{title:"\u8DEF\u5F84",key:"path",sorter:"default",render:e=>c("div",{class:"file-info"},[c("img",{src:e.icon_link}),c(M,{class:"title"},{default:()=>String(e.path)})])}]),x=()=>{k.value=JSON.parse(window.localStorage.getItem("pikpakMoveFiles")||"[]"),f.value=[],u.value=[]};ie(L,()=>{x()}),oe(()=>{x()});const P=e=>{e.target.offsetHeight+e.target.scrollTop>=e.target.scrollHeight-30},V=e=>{let t=[];f.value.forEach(s=>{if(u.value.indexOf(s.id)!==-1)t.push(s.id);else if(s.children)for(let n in s.children)u.value.indexOf(s.children[n].id)!==-1&&t.push(s.children[n].id)}),q(t),u.value=[]},q=e=>{k.value=e,window.localStorage.setItem("pikpakMoveFiles",JSON.stringify(e)),window.$message.success("\u526A\u5207\u6210\u529F\uFF0C\u8BF7\u70B9\u51FB\u9875\u9762\u53F3\u4E0A\u65B9\u7C98\u8D34\u6309\u94AE")},H=e=>{d.post("https://api-drive.mypikpak.com/drive/v1/files:batchTrash",{ids:typeof e=="string"?[e]:e}).then(()=>{K(typeof e=="string"?[e]:e),window.$message.success("\u5220\u9664\u6210\u529F"),u.value=[],m&&m()})},J=async()=>{const e=async o=>await d.get("https://api-drive.mypikpak.com/drive/v1/files/"+o,{params:{_magic:"2021",thumbnail_size:"SIZE_LARGE"}}),t=async()=>{const o=JSON.parse(JSON.stringify(u.value)),r=new Set;for(let y in f.value)f.value[y].kind==="drive#folder"&&r.add(f.value[y].id);const z=[];for(let y in o){if(r.has(o[y]))continue;const I=await e(o[y]);z.push({url:I.data.web_content_link,filename:I.data.name})}return z},s=o=>{const r="chrome_extension_id";chrome.runtime.sendMessage(r,{msg:"pikpak_batch_download",items:o})};v.value=N.create({title:"\u6279\u91CF\u4E0B\u8F7D\u6587\u4EF6",closable:!0,content:"\u6B63\u5728\u83B7\u53D6\u6587\u4EF6\u5217\u8868..."});const n=await t();u.value=[],v.value.content="\u5171\u83B7\u53D6\u5230"+n.length+"\u4E2A\u6587\u4EF6",s(n)},A=async()=>{f.value=await Q("name",E.value),m=A},$=async()=>{f.value=await Z(),m=$},j=async(e,t,s)=>{const n={phase:{eq:"PHASE_TYPE_COMPLETE"},trashed:{eq:!1}};return(await d.get("https://api-drive.mypikpak.com/drive/v1/files",{params:{parent_id:e,limit:t,filters:n,thumbnail_size:"SIZE_LARGE",with_audit:!0,page_token:s||void 0}})).data},G=async e=>{const t=100;let s="",n=[];for(let o=0;o<10;o++){const r=await j(e,t,s);if(n=n.concat(r.files),r.files.length<t||!r.next_page_token)break;s=r.next_page_token}return n},g="http://localhost:3000/pikpak",U=async(e,t)=>{await d.post(`${g}/files`,{parentIds:e,files:t})},Z=async()=>(await d.get(`${g}/files/redundancy`)).data,K=async e=>{await d.get(`${g}/delete/files/${e.join(",")}`)},Q=async(e,t)=>(await d.get(`${g}/files/${e}/${encodeURIComponent(t)}`)).data,X=async e=>(await d.get(`${g}/file/${e}`)).data,Y=async e=>{await d.get(`${g}/file/scanned/${e}`)},W=async e=>new Promise((t,s)=>{setTimeout(()=>{t()},e)}),R=async e=>{const t=e[e.length-1],s=await G(t);await U(e,s);for(let n=0;n<s.length;n++)s[n].kind=="drive#folder"&&((await X(s[n].id)).scanned||(await W(500),await R(e.concat([s[n].id])))),e.length==1&&F(`\u5DF2\u626B\u63CF${Math.floor((n+1)/s.length*100)}%(${n+1}/${s.length})...`);t!=""&&await Y(t)},F=async e=>{v.value&&v.value.destroy(),v.value=N.info({title:e,onClose:()=>{var t;return(t=v.value)==null||t.destroy(),!1}})},ee=async()=>{F("\u5F00\u59CB\u626B\u63CF\u5168\u76D8...");try{await R([""]),F("\u626B\u63CF\u5B8C\u6210")}catch(e){F("\u626B\u63CF\u51FA\u9519: "+e)}};return(e,t)=>(w(),B("div",Ce,[_("div",Ee,[_("div",Be,[l(a(ue),null,{default:i(()=>[l(a(de),{placeholder:"\u6587\u4EF6\u540D\u3001hash",value:E.value,"onUpdate:value":t[0]||(t[0]=s=>E.value=s)},{prefix:i(()=>[l(a(fe))]),_:1},8,["value"]),l(a(C),{type:"primary",ghost:"",onClick:A},{default:i(()=>[De]),_:1})]),_:1})]),_("div",Se,[l(a(ce),null,{default:i(()=>{var s;return[((s=k.value)==null?void 0:s.length)?(w(),he(a(C),{key:0,type:"default"},{default:i(()=>[h(" \u7C98\u8D34\u5DF2\u526A\u5207"+pe(k.value.length)+"\u9879\u8D44\u6E90 ",1)]),_:1})):S("",!0),l(a(C),{onClick:$},{default:i(()=>[be]),_:1}),l(a(_e),{onPositiveClick:ee},{trigger:i(()=>[l(a(C),null,{default:i(()=>[Ne]),_:1})]),_:1})]}),_:1})])]),l(a(re),{style:{"max-height":"calc(100vh - 190px)"},onScroll:P},{default:i(()=>[l(a(ve),{"checked-row-keys":u.value,"onUpdate:checked-row-keys":t[1]||(t[1]=s=>u.value=s),"row-key":s=>s.id,data:f.value,size:"small",columns:T.value,bordered:!1},null,8,["checked-row-keys","row-key","data","columns"]),O.value?(w(),B("div",xe,[l(a(ge),{size:"small"}),Ae])):S("",!0)]),_:1}),u.value.length?(w(),B("div",$e,[_("div",Re,[_("div",{class:"toolbar-item",onClick:V},[l(a(D),null,{trigger:i(()=>[l(a(b),null,{default:i(()=>[l(a(ye))]),_:1})]),default:i(()=>[ze]),_:1})]),_("div",{class:"toolbar-item",onClick:J},[l(a(D),null,{trigger:i(()=>[l(a(b),null,{default:i(()=>[l(a(ke))]),_:1})]),default:i(()=>[Ie]),_:1})]),_("div",{class:"toolbar-item",onClick:t[2]||(t[2]=s=>H(u.value))},[l(a(D),null,{trigger:i(()=>[l(a(b),null,{default:i(()=>[l(a(me))]),_:1})]),default:i(()=>[Me]),_:1})])])])):S("",!0)]))}});export{Pe as default};
